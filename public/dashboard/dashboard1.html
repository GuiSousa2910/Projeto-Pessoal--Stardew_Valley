<!DOCTYPE html>
<html lang="pt-br">

<head>
    <link rel="shortcut icon" href="../assets/icon/favicon2.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AquaTech | Dashboards</title>
    <link rel="stylesheet" href="./../css/dashboard.css">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="nav">
        <img src="../assets/galinha.png" alt="galinha">
        <div class="nav-list">
            <div class="sobre">
                <a href="indexLogado.html">Voltar</a>
            </div>
        </div>
    </div>

    <div class="centro">
        <div class="todas-infos" id="todas-info"
            style="background: linear-gradient(180deg, rgba(244, 212, 151, 1) 40%, rgba(182, 108, 63, 1) 71%); ">

            <div class="opcoes">
                <button class="botao" id="botao1" onclick="dashProdutos()">Produtos</button>
                <button class="botao" id="botao2" onclick="dashWhack()">Whack Junimo</button>
                <button class="botao" id="botao3" onclick="">Stardew Crush</button>
            </div>
            <div class="dash" style="gap: 100px ;">
                <div>
                    <p id="tituloPontosCC">Lista de Pontos por Rodada!</p>
                </div>
                <div>
                    <p id="tituloJunimosCor">Lista da Quantidade de Junimos por Cor! 
                        <span
                            class="material-symbols-outlined" style="font-weight: bolder;">
                            arrow_forward
                        </span>
                    </p>

                </div>
                <div class="chartCC" style="margin-top: -7rem;">
                    <div class="graficos">
                        <canvas id="myChart1"></canvas>
                        <canvas id="myChartPonto" style="display: none;"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>

</html>
<script>

    function dashProdutos() {
        window.location = '../dashboardStardew.html';
    }

    function dashWhack() {
        window.location = 'dashboard.html';
    }

    window.onload = async () => {
        obterDadosGrafico(sessionStorage.ID_USUARIO);
    };

    let pontosCC = [];
    let qntAzul = [];
    let qntLaranja = [];
    let qntAmarelo = [];
    let qntRoxo = [];
    let qntRosa = [];
    let qntVerde = [];
    let qntBranco = [];
    let jogoAtual = [];
    let dataAtual = [];

    // Função para obter os dados do gráfico do banco de dados
    function obterDadosGrafico(fkFazendeiro) {
        fetch(`/jogo2/buscarUltimosPontosCC/${fkFazendeiro}`)
            .then(function (response) {
                if (response.ok) {

                    response.json().then(function (resposta) {
                        console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                        for (let i = 0; i < resposta.length; i++) {
                            // Adiciona a data e hora do registro aos labels
                            // Adiciona a umidade e a temperatura aos dados
                            pontosCC.push(resposta[i].pontosCC);
                            qntAzul.push(resposta[i].qntAzul);
                            qntLaranja.push(resposta[i].qntLaranja);
                            qntAmarelo.push(resposta[i].qntAmarelo);
                            qntRoxo.push(resposta[i].qntRoxo);
                            qntRosa.push(resposta[i].qntRosa);
                            qntVerde.push(resposta[i].qntVerde);
                            qntBranco.push(resposta[i].qntBranco);
                            jogoAtual.push(resposta[i].idJogoCC);
                            dataAtual.push(resposta[i].hora);

                        }
                        sessionStorage.setItem('JogosCC', JSON.stringify(resposta));
                        // Plota o gráfico com os dados recebidos
                        plotarGrafico(resposta, fkFazendeiro);
                    });
                } else {
                    console.error('Nenhum dado encontrado ou erro na API');
                }
            })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }
    // Função para plotar o gráfico na página
    console.log('bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb');
    function plotarGrafico(resposta, fkFazendeiro) {
        console.log('iniciando plotagem do gráfico...');
        // Cria a estrutura para plotar o gráfico - labels (eixo x)
        let labels = [];
        // Cria a estrutura para plotar o gráfico - dados (eixo y)
        let dados = {
            labels: dataAtual,
            datasets: [

                {
                    label: 'qntBranco',
                    data: qntBranco,
                    fill: false,
                    borderColor: 'white',
                    tension: 0.1,
                    borderWidth: 5
                },
                {
                    label: 'qntAzul',
                    data: qntAzul,
                    fill: false,
                    borderColor: 'lightblue',
                    tension: 0.1,
                    borderWidth: 5
                },
                {
                    label: 'qntLaranja',
                    data: qntLaranja,
                    fill: false,
                    borderColor: 'orange',
                    tension: 0.1,
                    borderWidth: 5
                },
                {
                    label: 'qntAmarelo',
                    data: qntAmarelo,
                    fill: false,
                    borderColor: 'yellow',
                    tension: 0.1,
                    borderWidth: 5
                },
                {
                    label: 'qntRoxo',
                    data: qntRoxo,
                    fill: false,
                    borderColor: 'purple',
                    tension: 0.1,
                    borderWidth: 5
                },
                {
                    label: 'qntRosa',
                    data: qntRosa,
                    fill: false,
                    borderColor: 'pink',
                    tension: 0.1,
                    borderWidth: 5
                },
                {
                    label: 'qntVerde',
                    data: qntVerde,
                    fill: false,
                    borderColor: 'green',
                    tension: 0.1,
                    borderWidth: 5
                }
            ],
        };

        let dadosPontos = {
            labels: jogoAtual,
            datasets: [
                {
                    label: 'Pontos',
                    type: 'bar',
                    data: pontosCC,
                    backgroundColor: 'blue',
                    fill: false,
                    borderColor: 'green',
                    tension: 0.1,
                },
            ],
        };
        // Cria a configuração para o gráfico
        const config = {
            type: 'line', // Define o tipo de gráfico como linha
            data: dados
        };
        // Cria o gráfico e o adiciona à div na página
        let myChart = new Chart(
            document.getElementById(`myChart1`),
            config
        );

        const configPonto = {
            type: 'line', // Define o tipo de gráfico como linha
            data: dadosPontos,
        };
        // Cria o gráfico e o adiciona à div na página
        let myChartPonto = new Chart(
            document.getElementById(`myChartPonto`),
            configPonto
        );
    }

</script>